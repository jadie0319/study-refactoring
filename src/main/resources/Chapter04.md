# Chapter 04 - 테스트

> 리팩터링을 제대로 하기 위해선 견고한 테스트 스위트가 뒷받침되어야 한다.
 
## 4.1 자가 테스트 코드의 가치

대부분의 개발자는 디버깅하느라 오랜 시간이 걸리고 버그 픽스는 대체로 금방 끝난다.
또한 버그를 수정하는 과정에서 또다른 버그를 만들기도 하고, 그 버그를 찾느라 또 많은 시간을 소비한다.
이러한 비효율적인 일을 줄이기 위해 테스트 코드를 작성하기로 했다.

> 모든 테스트를 완전히 자동화하고 그 결과까지 스스로 검사하게 만들자.

이렇게 하니 테스트 코드 작성이 쉬워졌다. 컴파일할 때마다 테스트를 함께 하니 생산성도 오르고 디버깅 시간이 줄어들었다.
이런 테스트를 작은 간격으로 자주 수행했기 때문에 버그가 발생한 지점은 조금 전에 작성한 코드에 있었다.
즉 버그가 어디서 발생했는지 쉽게 찾을 수 있게 되고, 버그도 단 몇 분이면 해결할 수 있었다.

테스트를 작성하기 가장 좋은 시점은 프로그래밍을 시작하기 전이다.
테스트를 작성하면 원하는 기능을 추가하기 위해 무엇이 필요한지 고민하게 된다.
구현보다 인터페이스에 집중하게 된다는 장점이 있고, 코딩이 완료되는 시점을 정확하게 판단할 수 있다.
이렇게 테스트-코딩-리팩터링 과정으로 개발하는 방법이 테스트 주도 개발 (TDD) 이다.

테스트 코드가 없는 코드를 리팩터링 해야 할 때가 많을 것이다. 그럴 땐 테스트 코드를 먼저 작성한다.

## 4.2 테스트할 샘플 코드

테스트 샘플 소개

## 4.3 첫 번째 테스트

- 테스트에 필요한 데이터와 객체(테스트 픽스처)를 설정
- 픽스처의 속성들을 검증
  - 초기값에 기초하여 정확히 계산했는지 확인

> 실패해야 할 상황에서는 반드시 실패하게 만들자

  - 마음의 안정을 찾기 위해선 각각의 테스트가 실패하는 모습을 확인하는게 좋다
  - 흔한 방법은 일시적으로 코드에 오류를 주입하는 것이다.

> 자주 테스트하라. 작성 중인 코드는 최소한 몇분 간격으로 테스트하고, 적어도 하루에 한번은 전체 테스트를 돌려보자


## 4.4 테스트 추가하기

- 테스트는 위험 요인을 중심으로 작성해야 한다!!!!
- 테스트의 목적은 현재 혹은 향후에 발생할 가능성이 있는 버그를 찾는 데 있다.
  - 단순히 필드를 읽고 쓰기만 하는 접근자는 테스트할 필요 없다

> 완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행해보는게 낫다.

- 코드를 먼저 돌려서 기댓값(expected) 을 구하고 테스트를 수행한다
- 잘못된 기댓값을 주입한 오류를 테스트가 걸러내는게 확인되면, 만족해하며 원래 코드로 되돌린다
- 임시 값을 설정했다가 실제 값으로 대체하고, 오류를 심었다가 되돌리는 이 패턴은 실제로  
  내가 기존 코드를 검사하는 테스트를 추가할 때 흔히 쓰는 방식이다.
- 테스트는 순서에 영향을 받지 않게 작성해야 한다.
  - 테스트 순서에 따라 통과, 실패가 달라지면 테스트를 믿지 못하게 된다.
- 개별 테스트를 실행할 때마다 필스처를 새로 만들면 모든 테스트를 독립적으로 구성할 수 있다.

## 4.5 픽스처 수정하기

- 보통 세터는 단순하여 버그가 생길일이 없으니 테스트하지 않는다
- 하지만 단순 세터가 아닌 연산이 있는 복잡한 세터는 좀 복잡한 동작을 수행하기 때문에 테스트가 필요하다
- 테스트는 설정한 픽스처를 취해서, 테스트를 수행하고, 픽스처가 일을 기대한 대로 처리했는지 검증한다
  - 설정-실행-검증
  - 조건-발생-결과
  - 준비-수행-단언
- 해체, 청소라고 하는 단계도 있다.
  - 사용한 픽스처를 제거하여 각 테스트가 서로 영향을 주지 못하게 막는다

## 4.6 경계 조건 검사하기

- 경계 지점에서 문제가 생기면 어떤 일이 벌어지는 확인하는 테스트도 함께 작성하면 좋다
  - 예를 들면, 금액이 음수가 되는 경우가 있다
  - 프로그램에서 특이상황을 어떻게 처리하는게 좋을지 생각해 볼 수 있다.

> 문제가 생길 가능성이 있는 경계 조건을 생각해보고 그 부분을 집중적으로 테스트하자

- 아무리 테스트해도 버그없는 완벽한 프로그램은 만들 수 없다
- 코드에서 처리 과정이 복잡한 부분, 오류가 생길만한 부분을 찾아보자
- 테스트가 모든 버그를 걸러주진 못해도, 안심하고 리팩터링할 수 있는 보호막은 되어준다.

## 4.7 끝나지 않은 여정

- 테스트 용이성을 아키텍처 평가 기준으로 활용하는 사례도 있다. 그만큼 중요성이 커지고 있다.
- 단위 테스트란 코드의 작은 영역만을 대상으로 빠르게 실행되도록 설계된 테스트다.
- 컴포넌트간 상호작용 테스트, 소프트웨어의 다양한 계층의 연동 테스트, 성능 테스트 등 종류가 많다
- 기능을 추가할 때마다 테스트 추가는 물론, 기존 테스트도 다시 살펴본다.

> 버그를 발견하면 가장 먼저 그 버그를 드려내는 단위 테스트부터 작성하자.

- 테스트 코드 커버리지는 테스트 품질과는 크게 상관없다.
- 



